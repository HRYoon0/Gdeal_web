(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{283:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>d});var l=s(5155),r=s(2115),a=s(5404),n=s(6104),o=s(9086);let i=(0,r.createContext)({user:null,userProfile:null,loading:!0,profileLoading:!1,signIn:async()=>{},signUp:async()=>{},logout:async()=>{},resetPassword:async()=>{},updateUserProfile:async()=>{},updateEmailConsent:async()=>{},refreshUserProfile:async()=>{}}),c=()=>(0,r.useContext)(i);function d(e){let{children:t}=e,[c,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[u,g]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("\uD83D\uDD25 AuthContext useEffect 시작");let e=setTimeout(()=>{console.log("⚠️ 5초 후에도 로딩 중 - 강제 로딩 해제"),g(!1)},5e3),t=(0,a.hg)(n.j,async t=>{if(console.log("\uD83D\uDD04 onAuthStateChanged 실행:",null==t?void 0:t.uid),clearTimeout(e),f||y)return void console.log("⏸️ 회원가입/로그인 과정 중이므로 onAuthStateChanged 무시");if(t){console.log("\uD83D\uDC64 사용자 감지됨:",t.uid),p(!0),d(t);try{console.log("\uD83D\uDCCB getUserProfile 호출 시작");let e=await (0,o.VM)(t.uid);console.log("\uD83D\uDCCB getUserProfile 결과:",e),e&&"approved"===e.status?(x(e),console.log("✅ 승인된 사용자 프로필 설정 완료")):e&&"approved"!==e.status?(console.log("❌ 승인되지 않은 사용자 - 로그아웃 처리"),d(null),x(null),await (0,a.CI)(n.j)):(console.log("⚠️ 프로필 없음 - user 상태는 유지, userProfile은 null"),x(null))}catch(e){console.error("\uD83D\uDCA5 onAuthStateChanged 에러:",e),console.log("\uD83D\uDD27 에러 발생했지만 user 상태는 유지"),x(null),console.log("\uD83D\uDD0D 에러 상세:",e instanceof Error?e.message:String(e))}finally{p(!1)}}else console.log("\uD83D\uDEAA 로그아웃 상태"),d(null),x(null),p(!1);console.log("\uD83C\uDFC1 AuthContext 처리 완료 - 로딩 해제"),g(!1)});return()=>{clearTimeout(e),t()}},[f,y]);let j=async(e,t)=>{try{v(!0),console.log("로그인 시도 시작");let s=(await (0,a.x9)(n.j,e,t)).user;console.log("Firebase 인증 성공, UID:",s.uid),console.log("사용자 상태 확인 시작");let l=null,r=null,i=!1;try{if(console.log("getUserProfile 호출 시작"),l=await (0,o.VM)(s.uid),console.log("getUserProfile 성공, 결과:",l),l&&"approved"===l.status){console.log("승인된 사용자 로그인 성공"),d(s),x(l),v(!1);return}}catch(e){console.error("getUserProfile 에러 (무시하고 계속):",e),i=!0}if(!l)try{console.log("getPendingUser 호출 시작"),r=await (0,o.bN)(s.uid),console.log("getPendingUser 성공, 결과:",r)}catch(e){console.error("getPendingUser 에러 (무시하고 계속):",e),i=!0}if(console.log("❌ 승인되지 않은 사용자, 로그아웃 처리"),await (0,a.CI)(n.j),v(!1),l)if("pending"===l.status)throw Error("승인 대기 중입니다. 관리자 승인 후 로그인할 수 있습니다.");else if("rejected"===l.status)throw Error("회원가입이 승인되지 않았습니다. 관리자에게 문의해주세요.");else throw Error("알 수 없는 사용자 상태입니다. 관리자에게 문의해주세요.");if(r)throw Error("승인 대기 중입니다. 관리자 승인 후 로그인할 수 있습니다.");if(i)throw Error("로그인 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");else throw Error("등록되지 않은 계정입니다. 회원가입을 진행해주세요.")}catch(e){throw console.error("signIn 에러:",e),v(!1),e}},N=async(e,t,s,l,r)=>{try{b(!0);let i=!1;try{let{user:c}=await (0,a.eJ)(n.j,e,t);await (0,a.r7)(c,{displayName:s}),await (0,o.EE)({uid:c.uid,email:c.email,displayName:s,school:l,authProvider:"email",emailConsent:(null==r?void 0:r.optional)||null,consentDate:(null==r?void 0:r.optional)?new Date:null}),console.log("✅ 회원가입 성공 - pending user 생성 완료"),i=!0}catch(c){if(c instanceof Error&&"code"in c&&"auth/email-already-in-use"===c.code){console.log("\uD83D\uDD04 Firebase Auth 사용자는 존재하지만 Firestore 데이터 확인 중...");let{user:c}=await (0,a.x9)(n.j,e,t);console.log("\uD83D\uDD0D 기존 사용자 UID:",c.uid);let d=await (0,o.VM)(c.uid),m=await (0,o.bN)(c.uid);if(d||m)throw console.log("❌ 이미 등록된 사용자 - 기존 데이터 존재"),b(!1),await (0,a.CI)(n.j).catch(e=>console.error("로그아웃 에러:",e)),Error("이미 등록된 계정입니다.");console.log("✅ Firestore 데이터 없음 - 새로 생성"),await (0,a.r7)(c,{displayName:s}),await (0,o.EE)({uid:c.uid,email:c.email,displayName:s,school:l,authProvider:"email",emailConsent:(null==r?void 0:r.optional)||null,consentDate:(null==r?void 0:r.optional)?new Date:null}),console.log("✅ 새로운 pending user 생성 완료"),i=!0}else throw b(!1),c}if(i){b(!1);try{await (0,a.CI)(n.j),console.log("✅ 회원가입 후 로그아웃 완료")}catch(e){console.error("⚠️ 로그아웃 에러 (무시):",e)}}}catch(e){throw b(!1),e}},w=async()=>{try{await (0,a.CI)(n.j),d(null),x(null),console.log("로그아웃 완료")}catch(e){throw console.error("로그아웃 에러:",e),e}},E=async e=>{try{await (0,a.J1)(n.j,e)}catch(e){throw e}},k=async()=>{if(c)try{p(!0),console.log("\uD83D\uDD04 강제로 userProfile 새로고침 시도");let e=await (0,o.VM)(c.uid);console.log("\uD83D\uDD04 강제 새로고침 결과:",e),e&&"approved"===e.status?(x(e),console.log("✅ userProfile 새로고침 성공")):(console.log("❌ 승인되지 않은 사용자 또는 프로필 없음"),x(null))}catch(e){console.error("❌ userProfile 새로고침 실패:",e)}finally{p(!1)}},C=async e=>{try{if(!c||!m)throw Error("사용자 정보가 없습니다.");e.displayName&&await (0,a.r7)(c,{displayName:e.displayName});let{updateDoc:t,doc:l}=await Promise.resolve().then(s.bind(s,5317)),{db:r}=await Promise.resolve().then(s.bind(s,6104)),n=l(r,"users",c.uid);await t(n,e),x(t=>t?{...t,...e}:null)}catch(e){throw e}},S=async e=>{try{if(!c)throw Error("사용자 정보가 없습니다.");console.log("\uD83D\uDD04 AuthContext updateEmailConsent 호출:",{사용자:c.uid,새로운_동의_상태:e}),await (0,o.ih)(c.uid,e),x(t=>t?{...t,emailConsent:!!e||null,consentDate:e?new Date:null}:null),console.log("✅ AuthContext updateEmailConsent 완료")}catch(e){throw console.error("❌ AuthContext updateEmailConsent 실패:",e),e}};return(0,l.jsx)(i.Provider,{value:{user:c,userProfile:m,loading:u,profileLoading:h,signIn:j,signUp:N,logout:w,resetPassword:E,updateUserProfile:C,updateEmailConsent:S,refreshUserProfile:k},children:t})}},2154:(e,t,s)=>{Promise.resolve().then(s.bind(s,2930))},2930:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var l=s(5155),r=s(2115),a=s(6681),n=s(9086),o=s(6766);let i=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#F4D03F","#D2B4DE","#AED6F1","#A3E4D7","#F9E79F","#FADBD8"];function c(e){let t=e.replace("#",""),s=parseInt(t.substr(0,2),16),l=parseInt(t.substr(2,2),16);return .299*s+.587*l+.114*parseInt(t.substr(4,2),16)>128?"#2D3748":"#FFFFFF"}function d(e){let{iconId:t,size:s=60,onClick:r,className:a=""}=e;return(0,l.jsx)("div",{className:"relative inline-block ".concat(r?"cursor-pointer hover:scale-105 transition-transform":""," ").concat(a),style:{width:s,height:s},onClick:r,children:(0,l.jsx)(o.default,{src:"/emotions/".concat(t,".png?v=3"),alt:"감정 ".concat(t),width:s,height:s,className:"w-full h-full object-contain",unoptimized:!0})})}function m(e){let{emotion:t,size:s="md",onClick:r}=e,a=c(t.color);return(0,l.jsx)("div",{className:"rounded-full font-medium transition-all ".concat(r?"cursor-pointer hover:opacity-80":""," ").concat({sm:"px-3 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s]),style:{backgroundColor:t.color,color:a},onClick:r,children:t.text})}function x(e){let{isOpen:t,onClose:s,onSave:a,initialEmotion:n}=e,[o,m]=(0,r.useState)((null==n?void 0:n.iconId)||"1"),[x,u]=(0,r.useState)((null==n?void 0:n.text)||""),[g,h]=(0,r.useState)((null==n?void 0:n.color)||"#87CEEB");if(!t)return null;let p=c(g);return(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:e=>{e.target===e.currentTarget&&s()},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"감정 설정"}),(0,l.jsx)("button",{onClick:s,className:"text-2xl text-gray-500 hover:text-gray-700",children:"\xd7"})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"아이콘 선택"}),(0,l.jsx)("div",{className:"grid grid-cols-5 gap-3 max-h-40 overflow-y-auto p-2 border rounded-lg touch-pan-y",style:{WebkitOverflowScrolling:"touch"},children:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19].map(e=>(0,l.jsx)("div",{className:"p-2 rounded-lg border-2 cursor-pointer transition-all ".concat(o===e.toString()?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>m(e.toString()),children:(0,l.jsx)(d,{iconId:e.toString(),size:40})},e))})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block text-base font-medium text-gray-800 mb-3",children:"감정 텍스트 입력"}),(0,l.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),placeholder:"감정을 자유롭게 입력하세요 (예: 기쁨, 슬픔, 화남)",className:"w-full px-4 py-3 text-lg font-semibold text-gray-900 bg-white border-2 border-gray-400 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all placeholder-gray-500",maxLength:10}),(0,l.jsxs)("div",{className:"mt-2 flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"최대 10글자까지 입력 가능"}),(0,l.jsxs)("span",{className:"text-sm font-semibold text-gray-800",children:[x.length,"/10"]})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block text-base font-medium text-gray-800 mb-3",children:"배경 색상 선택"}),(0,l.jsx)("div",{className:"grid grid-cols-10 gap-2 mb-3",children:i.map(e=>(0,l.jsx)("button",{className:"w-8 h-8 rounded-full border-2 transition-all ".concat(g===e?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-500"),style:{backgroundColor:e},onClick:()=>h(e)},e))}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"color",value:g,onChange:e=>h(e.target.value),className:"w-8 h-8 rounded border border-gray-300 cursor-pointer"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"직접 색상 선택"})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"미리보기"}),(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-gray-50 rounded-lg",children:[(0,l.jsx)(d,{iconId:o,size:80}),(0,l.jsx)("div",{className:"px-6 py-3 rounded-full text-base font-semibold min-w-[120px] text-center shadow-sm border border-gray-200",style:{backgroundColor:g,color:p},children:x||"감정 텍스트"}),!x&&(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 text-center",children:"위에 감정을 입력하면 여기에 미리보기가 표시됩니다"})]})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"취소"}),(0,l.jsx)("button",{onClick:()=>{if(!x.trim())return void alert("감정을 입력해주세요.");a({iconId:o,text:x.trim(),color:g}),s()},className:"flex-1 px-4 py-2 bg-[#66ae7d] text-white rounded-lg hover:bg-[#497e56] transition-colors",children:"저장"})]})]})})}let u=[{iconId:"1",text:"평온",color:"#87CEEB"}];var g=s(9137),h=s.n(g),p=s(2515);let f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l="AIzaSyASgrkie4njd-Mk0uF1FbPYj0w9UPg0sOE",r="e6809f8024f2b49d6";if(!l)throw console.error("Google API 키가 설정되지 않았습니다. 검색을 수행할 수 없습니다."),Error("Google API 키가 설정되지 않았습니다.");if(!r)throw console.error("Google Search Engine ID가 설정되지 않았습니다. 검색을 수행할 수 없습니다."),Error("Google Search Engine ID가 설정되지 않았습니다.");try{let i=new URL("https://www.googleapis.com/customsearch/v1");i.searchParams.set("key",l),i.searchParams.set("cx",r),i.searchParams.set("q",e),i.searchParams.set("searchType","image"),i.searchParams.set("num",Math.min(t,10).toString()),i.searchParams.set("start",s.toString()),i.searchParams.set("safe","off"),i.searchParams.set("lr","lang_ko"),i.searchParams.set("hl","ko"),i.searchParams.set("gl","kr"),console.log("=== Google 이미지 검색 시작 ==="),console.log("API Key 존재:",!!l),console.log("Search Engine ID:",r),console.log("검색어:",e),console.log("완전한 요청 URL:",i.toString());let c=await fetch(i.toString());if(console.log("응답 상태:",c.status,c.statusText),console.log("응답 헤더:",Object.fromEntries(c.headers.entries())),!c.ok){let e=await c.text();console.error("=== Google 검색 API 오류 ==="),console.error("Status:",c.status),console.error("Status Text:",c.statusText),console.error("Error Response:",e);try{let t=JSON.parse(e);console.error("Parsed Error:",t),t.error&&(console.error("Error Code:",t.error.code),console.error("Error Message:",t.error.message),console.error("Error Details:",t.error.details))}catch(t){console.error("Error response is not JSON:",e)}return console.log("API 오류로 인해 빈 결과 반환"),[]}let d=await c.json();if(console.log("=== Google 검색 API 성공 응답 ==="),console.log("전체 응답 데이터:",JSON.stringify(d,null,2)),console.log("Items 존재:",!!d.items),console.log("Items 길이:",d.items?d.items.length:"undefined"),console.log("검색 정보:",d.searchInformation),console.log("쿼리 정보:",d.queries),!d.items||0===d.items.length){var a,n,o;return console.log("=== 검색 결과 없음 분석 ==="),console.log("전체 검색 결과 수:",(null==(a=d.searchInformation)?void 0:a.totalResults)||"0"),console.log("실제 검색 시간:",(null==(n=d.searchInformation)?void 0:n.searchTime)||"unknown"),(null==(o=d.searchInformation)?void 0:o.totalResults)==="0"&&console.log("Google에서 해당 키워드로 이미지를 찾을 수 없음"),console.log("검색 결과 없음"),[]}return d.items.map(e=>{var t,s,l;return{url:e.link,title:e.title||e.snippet||"이미지",thumbnail:null==(t=e.image)?void 0:t.thumbnailLink,width:null==(s=e.image)?void 0:s.width,height:null==(l=e.image)?void 0:l.height}})}catch(e){throw console.error("Google 이미지 검색 중 오류 발생:",e),e}};function b(e){var t;let{isOpen:s,onClose:a,onSave:n,initialData:i,isEditing:c=!1}=e,[g,b]=(0,r.useState)((null==i?void 0:i.mood)||u.find(e=>"평온"===e.text)||u[0]),[y,v]=(0,r.useState)((null==i?void 0:i.content)||""),[j,N]=(0,r.useState)((null==i?void 0:i.title)||""),[w,E]=(0,r.useState)(null!=(t=null==i?void 0:i.tags)?t:""),[k,C]=(0,r.useState)((null==i?void 0:i.date)||new Date().toISOString().split("T")[0]),[S,D]=(0,r.useState)(!1),[A,I]=(0,r.useState)(!1),[T,P]=(0,r.useState)(""),[R,_]=(0,r.useState)("search"),[L,U]=(0,r.useState)(""),[O,F]=(0,r.useState)([]),[M,z]=(0,r.useState)(!1),[B,H]=(0,r.useState)(!1),[G,q]=(0,r.useState)(!0),[W,K]=(0,r.useState)(1);(0,r.useRef)(null);let V=(0,r.useRef)(null),$=(0,r.useRef)(null),J=()=>{let e=V.current;e&&v(X(e.innerHTML))},Y=()=>{let e=V.current;if(e)try{e.focus({preventScroll:!0}),setTimeout(()=>{try{let l=window.getSelection();if(!l)return;l.removeAllRanges();let r=document.createRange(),a=e.lastChild;if(a&&""!==e.textContent.trim())if(a.nodeType===Node.TEXT_NODE){var t,s;r.setStart(a,(null==(t=a.textContent)?void 0:t.length)||0),r.setEnd(a,(null==(s=a.textContent)?void 0:s.length)||0)}else r.selectNodeContents(a),r.collapse(!1);else r.selectNodeContents(e),r.collapse(!1);l.addRange(r),console.log("커서를 맨 아래로 이동했습니다 - 개선된 버전"),setTimeout(()=>{try{let t=r.getBoundingClientRect();if(0===t.height||0===t.top)e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"});else{let e=window.scrollY+t.top-window.innerHeight/2;window.scrollTo({top:Math.max(0,e),behavior:"smooth"})}}catch(t){console.log("스크롤 중 오류:",t),e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}},150)}catch(e){console.error("내부 커서 설정 중 오류:",e)}},50)}catch(e){console.error("커서 이동 중 오류:",e)}};if((0,r.useEffect)(()=>{let e=V.current;if(e)if(y){let t=Z(y);X(e.innerHTML)!==y&&(console.log("contentEditable 업데이트:",y,"→",t),e.innerHTML=t)}else""!==e.innerHTML&&(e.innerHTML="")},[y]),(0,r.useEffect)(()=>{"search"===R&&A&&$.current&&setTimeout(()=>{var e;null==(e=$.current)||e.focus()},100)},[R,A]),(0,r.useEffect)(()=>{if(s)if(console.log("DiaryEditor 열림 - 편집모드:",c,"initialData:",!!i),i){var e;console.log("편집 모드로 DiaryEditor 열림:",{title:i.title,content:(null==(e=i.content)?void 0:e.substring(0,50))+"...",mood:i.mood,tags:i.tags,date:i.date}),b(i.mood||u.find(e=>"평온"===e.text)||u[0]),v(i.content||""),N(i.title||""),E(i.tags||""),C(i.date||new Date().toISOString().split("T")[0])}else console.log("새 일기 작성 모드로 DiaryEditor 열림"),b(u.find(e=>"평온"===e.text)||u[0]),v(""),N(""),E(""),C(new Date().toISOString().split("T")[0]);else console.log("DiaryEditor 닫힘 - 상태 초기화"),b(u.find(e=>"평온"===e.text)||u[0]),v(""),N(""),E(""),C(new Date().toISOString().split("T")[0]),I(!1),P(""),U(""),F([])},[s,i]),!s)return null;let Q=e=>{let t=e||T.trim();if(!t)return void alert("이미지 URL을 입력해주세요.");console.log("이미지 삽입 시작:",t);let s=V.current;if(!s)return void console.error("editableRef가 없습니다");try{let e='\n        <div class="my-4 text-center relative group" style="display: block; margin: 16px 0; clear: both;">\n          <div class="relative inline-block">\n            <img src="'.concat(t,'" alt="이미지" class="max-w-full h-auto rounded-lg shadow-sm mx-auto" style="max-width: 400px; height: auto; display: block; margin: 0 auto;" onload="console.log(\'이미지 로드 성공\')" onerror="console.error(\'이미지 로드 실패:\', this.src)" />\n            <button class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200" onclick="this.parentElement.parentElement.remove(); console.log(\'이미지 삭제됨\')" title="이미지 삭제" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; padding: 0;">\n              <span style="font-size: 14px; line-height: 1; font-weight: bold;">\xd7</span>\n            </button>\n          </div>\n        </div>\n      ');P(""),U(""),F([]),K(1),q(!0),I(!1),setTimeout(()=>{try{let t;s.focus({preventScroll:!0});let l=s.querySelector('span[id^="cursor-marker-"]');if(l)(t=document.createRange()).setStartBefore(l),t.setEndBefore(l),l.remove();else{let e=window.getSelection();e&&e.rangeCount>0?t=e.getRangeAt(0):((t=document.createRange()).selectNodeContents(s),t.collapse(!1))}let r=t.createContextualFragment(e);t.deleteContents(),t.insertNode(r),setTimeout(()=>{try{let e=document.createRange(),t=window.getSelection(),l=s.querySelectorAll(".my-4"),r=l[l.length-1];if(r&&r.parentNode){console.log("마지막 이미지 div 찾음:",r);let l=document.createElement("p");l.innerHTML="<br>",l.style.minHeight="1.5em",l.style.margin="0",l.style.padding="0",r.nextSibling?r.parentNode.insertBefore(l,r.nextSibling):r.parentNode.appendChild(l),e.setStart(l,0),e.collapse(!0),null==t||t.removeAllRanges(),null==t||t.addRange(e),s.focus({preventScroll:!0}),setTimeout(()=>{l.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},50),console.log("이미지 삽입 완료, 커서를 이미지 아래로 설정되고 화면 스크롤됨")}else console.warn("이미지 div를 찾을 수 없습니다"),e.selectNodeContents(s),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e),s.focus({preventScroll:!0}),setTimeout(()=>{s.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},50)}catch(e){console.error("커서 위치 설정 중 오류:",e)}finally{J()}},100)}catch(e){console.error("이미지 삽입 중 오류:",e),J()}},150)}catch(e){console.error("이미지 삽입 중 오류:",e),P(""),U(""),F([]),K(1),q(!0),I(!1)}},X=e=>{if(!e)return"";console.log("HTML 변환 전:",e);let t=e;return console.log("마크다운 변환 후:",t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<div[^>]*class="[^"]*my-4[^"]*"[^>]*>[\s\S]*?<img[^>]+src="([^"]+)"[^>]*alt="([^"]*)"[^>]*\/?>[\s\S]*?<\/div>/g,"![이미지]($1)")).replace(/<div[^>]*class='[^']*my-4[^']*'[^>]*>[\s\S]*?<img[^>]+src='([^']+)'[^>]*alt='([^']*)'[^>]*\/?>[\s\S]*?<\/div>/g,"![이미지]($1)")).replace(/<br\s*\/?>/gi,"\n")).replace(/<div\s*><\/div>/gi,"\n")).replace(/<div\s*>/gi,"\n")).replace(/<\/div>/gi,"")).replace(/<p\s*>/gi,"")).replace(/<\/p>/gi,"\n")).replace(/<[^>]+>/g,"")).replace(/&nbsp;/g," ")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&")).replace(/\n{3,}/g,"\n\n")).split("\n").map(e=>e.trim()).join("\n")).replace(/^\n+/,"").replace(/\n+$/,"")),t},Z=e=>{if(!e)return"";let t=e,s={};return t=(t=t.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,l,r)=>{let a="__IMAGE_TEMP_PLACEHOLDER_".concat(r,"__"),n='<div class="my-4 text-center relative group"><div class="relative inline-block"><img src="'.concat(l,'" alt="').concat(t||"이미지",'" class="max-w-full h-auto rounded-lg shadow-sm mx-auto" style="max-width: 400px;" /><button class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200" onclick="this.parentElement.parentElement.remove(); console.log(\'이미지 삭제됨\')" title="이미지 삭제"><span class="text-sm font-bold">\xd7</span></button></div></div>');return s[a]=n,a})).replace(/\n/g,"<br>"),Object.keys(s).forEach(e=>{t=t.replace(e,s[e])}),t},ee=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e||L.trim();if(!s)return void alert("검색어를 입력해주세요.");t?H(!0):(F([]),z(!0),K(1),q(!0));try{let e=t?W:1;console.log('이미지 검색 시작: "'.concat(s,'", 시작 인덱스: ').concat(e));let l=await f(s,10,e);console.log("검색 결과:",l);let r=l.filter(e=>(e=>{try{return new URL(e),!0}catch(e){return!1}})(e.url));console.log("필터링된 안전한 결과:",r),t?(F(e=>[...e,...r]),K(e=>e+10)):(F(r),K(11)),r.length<10&&q(!1),t||0!==r.length||alert("검색 결과가 없습니다. 다른 키워드로 검색해보세요.")}catch(e){console.error("이미지 검색 실패:",e),alert("이미지 검색에 실패했습니다. 잠시 후 다시 시도해주세요.")}finally{z(!1),H(!1)}};return(0,l.jsxs)("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,l.jsx)("button",{onClick:a,className:"text-2xl font-light text-gray-600 hover:text-gray-800",children:"\xd7"}),(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("div",{className:"text-lg font-light text-gray-800",children:"교단일기"})}),(0,l.jsx)("button",{onClick:()=>{if(!y.trim())return void alert("일기 내용을 입력해주세요.");n({title:j,content:y,mood:g,tags:w,date:k})},className:"text-2xl font-light text-gray-600 hover:text-green-600",children:(0,l.jsx)(p.g9_,{})})]}),(0,l.jsxs)("div",{className:"text-center py-4 md:py-6 bg-gray-50",children:[(0,l.jsx)("input",{type:"date",value:k,onChange:e=>C(e.target.value),className:"text-lg md:text-xl font-medium text-gray-800 border-2 border-gray-300 rounded-lg px-4 md:px-6 py-2 md:py-3 text-center bg-white focus:outline-none focus:border-[#66ae7d] shadow-sm mb-2 md:mb-3"}),(0,l.jsx)("div",{className:"text-base md:text-lg text-gray-600 font-medium",children:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"][new Date(k).getDay()]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center p-4 md:p-8 space-y-4 md:space-y-8 overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-3 md:space-y-4",children:[(0,l.jsx)("div",{className:"cursor-pointer hover:scale-105 transition-transform",children:(0,l.jsx)(d,{iconId:g.iconId,size:100,onClick:()=>D(!0)})}),(0,l.jsx)(m,{emotion:g,size:"md",onClick:()=>D(!0)})]}),(0,l.jsx)(x,{isOpen:S,onClose:()=>D(!1),onSave:e=>{b(e),D(!1)},initialEmotion:g}),(0,l.jsxs)("div",{className:"jsx-e3acbf4f4e6e4057 w-full max-w-2xl flex-1 relative",children:[(0,l.jsx)("div",{ref:V,contentEditable:!0,suppressContentEditableWarning:!0,onInput:J,onKeyUp:e=>{let t=V.current;t&&""===t.innerText.trim()&&(t.style.textAlign="center")},style:{fontFamily:"'Noto Sans KR', sans-serif",lineHeight:"2",fontSize:"16px",minHeight:"300px"},"data-placeholder":"오늘의 교육 경험을 자유롭게 적어보세요...",className:"jsx-e3acbf4f4e6e4057 w-full h-full resize-none border-none outline-none text-center text-gray-800 text-lg leading-relaxed p-4 wysiwyg-editor"}),(0,l.jsx)(h(),{id:"e3acbf4f4e6e4057",children:".wysiwyg-editor.jsx-e3acbf4f4e6e4057:empty:before{content:attr(data-placeholder);color:#9ca3af;pointer-events:none}.wysiwyg-editor.jsx-e3acbf4f4e6e4057:focus{outline:none}.wysiwyg-editor.jsx-e3acbf4f4e6e4057 img.jsx-e3acbf4f4e6e4057{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.wysiwyg-editor.jsx-e3acbf4f4e6e4057 .my-4.jsx-e3acbf4f4e6e4057{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.wysiwyg-editor.jsx-e3acbf4f4e6e4057::selection{background:rgba(59,130,246,.3)}.wysiwyg-editor.jsx-e3acbf4f4e6e4057::-moz-selection{background:rgba(59,130,246,.3)}"}),(0,l.jsx)("button",{onClick:()=>{let e=V.current;if(e){e.focus();let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0),s=document.createElement("span");s.id="cursor-marker-"+Date.now(),s.style.display="none";try{e.insertNode(s)}catch(e){console.error("커서 마커 삽입 실패:",e)}}}I(!0)},title:"이미지 추가",className:"jsx-e3acbf4f4e6e4057 absolute bottom-2 md:bottom-4 right-2 md:right-4 bg-[#66ae7d] hover:bg-[#497e56] text-white p-2 md:p-3 rounded-full shadow-lg transition-all duration-200 transform hover:scale-105",children:(0,l.jsx)(p.TbK,{className:"text-lg md:text-xl"})})]}),(0,l.jsx)("div",{className:"w-full max-w-md",children:(0,l.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),placeholder:"일기 제목 (선택사항)",className:"w-full text-center border-b border-gray-300 bg-transparent focus:outline-none focus:border-gray-500 pb-2 text-gray-800 placeholder-gray-500",style:{fontSize:"16px",fontWeight:"500",color:"#1f2937"}})}),(0,l.jsxs)("div",{className:"w-full max-w-md",children:[(0,l.jsx)("input",{type:"text",value:w,onChange:e=>E(e.target.value),placeholder:"태그를 쉼표로 구분해서 입력하세요 (예: 수업준비, 학생상담)",className:"w-full text-center text-sm text-gray-800 border border-gray-300 rounded-lg px-4 py-2 bg-white focus:outline-none focus:border-[#66ae7d] placeholder-gray-400"}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1 text-center",children:"태그는 쉼표(,)로 구분해주세요"})]})]}),(0,l.jsx)("div",{className:"h-16"}),A&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",onClick:e=>{if(e.target===e.currentTarget){let e=V.current;if(e){let t=e.querySelector('span[id^="cursor-marker-"]');t&&t.remove()}I(!1),P(""),U(""),F([]),K(1),q(!0),_("search"),setTimeout(()=>{Y()},300)}},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"이미지 추가"}),(0,l.jsx)("button",{onClick:()=>{let e=V.current;if(e){let t=e.querySelector('span[id^="cursor-marker-"]');t&&t.remove()}I(!1),P(""),U(""),F([]),K(1),q(!0),_("search"),setTimeout(()=>{Y()},300)},className:"text-xl text-gray-500 hover:text-gray-700 transition-colors",children:(0,l.jsx)(p.m6K,{})})]}),(0,l.jsxs)("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg",children:[(0,l.jsx)("button",{onClick:()=>_("url"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("url"===R?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-800"),children:"URL 입력"}),(0,l.jsx)("button",{onClick:()=>_("search"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("search"===R?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-800"),children:"이미지 검색"})]}),"url"===R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이미지 URL"}),(0,l.jsx)("input",{type:"url",value:T,onChange:e=>P(e.target.value),placeholder:"https://example.com/image.jpg",className:"w-full px-4 py-3 text-base font-medium text-gray-900 bg-white border-2 border-gray-400 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all placeholder-gray-600",autoFocus:!0}),(0,l.jsx)("p",{className:"text-sm font-medium text-gray-700 mt-2",children:"이미지 URL을 입력하면 커서 위치에 이미지가 삽입됩니다."})]}),T&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"미리보기"}),(0,l.jsx)("div",{className:"border rounded-lg p-2 bg-gray-50",children:(0,l.jsx)(o.default,{src:T,alt:"미리보기",width:200,height:150,className:"max-w-full h-auto rounded",unoptimized:!0,onError:e=>{e.currentTarget.style.display="none"}})})]})]}),"search"===R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이미지 검색"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("input",{ref:$,type:"text",value:L,onChange:e=>U(e.target.value),placeholder:"검색할 이미지 키워드를 입력하세요",className:"flex-1 px-4 py-3 text-base font-medium text-gray-900 bg-white border-2 border-gray-400 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all placeholder-gray-600",onKeyPress:e=>{"Enter"===e.key&&ee()}}),(0,l.jsx)("button",{onClick:()=>ee(),disabled:M,className:"px-6 py-3 bg-[#66ae7d] text-white rounded-lg hover:bg-[#497e56] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:M?"검색중...":"검색"})]}),(0,l.jsx)("p",{className:"text-sm font-medium text-gray-700 mt-2",children:"원하는 이미지를 검색하세요."})]}),(O.length>0||M)&&(0,l.jsxs)("div",{className:"mb-4",children:[!M&&(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["검색 결과 (",O.length,"개) - 클릭하여 선택"]}),M&&(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\uD83D\uDD0D “",L,"” 검색 중..."]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 max-h-96 overflow-y-auto",onScroll:e=>{let{scrollTop:t,scrollHeight:s,clientHeight:l}=e.target;s-t<=1.5*l&&G&&!B&&!M&&O.length>0&&ee(L,!0)},children:[M&&0===O.length&&Array.from({length:6}).map((e,t)=>(0,l.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-2 animate-pulse",children:[(0,l.jsx)("div",{className:"w-full aspect-square bg-gray-200 rounded mb-2"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded mb-1"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]},"skeleton-".concat(t))),O.map((e,t)=>(0,l.jsxs)("div",{onClick:()=>Q(e.url),className:"cursor-pointer border-2 border-gray-200 rounded-lg p-2 hover:bg-gray-50 hover:border-[#66ae7d] hover:shadow-md transition-all duration-200 group",children:[(0,l.jsx)("div",{className:"relative overflow-hidden rounded aspect-square",children:(0,l.jsx)(o.default,{src:e.url,alt:e.title,fill:!0,className:"object-cover transition-transform duration-200 group-hover:scale-105",unoptimized:!0,onError:t=>{e.thumbnail&&t.currentTarget.src===e.url?t.currentTarget.src=e.thumbnail:t.currentTarget.style.display="none"}})}),(0,l.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate leading-tight",title:e.title,children:e.title})]},"".concat(e.url,"-").concat(t))),B&&Array.from({length:3}).map((e,t)=>(0,l.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-2 animate-pulse",children:[(0,l.jsx)("div",{className:"w-full aspect-square bg-gray-200 rounded mb-2"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded mb-1"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]},"loading-skeleton-".concat(t))),!G&&O.length>0&&(0,l.jsx)("div",{className:"col-span-3 text-center py-4 text-sm text-gray-500",children:"더 이상 검색 결과가 없습니다"})]})]})]}),(0,l.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,l.jsx)("button",{onClick:()=>{let e=V.current;if(e){let t=e.querySelector('span[id^="cursor-marker-"]');t&&t.remove()}I(!1),P(""),U(""),F([]),K(1),q(!0),_("search"),setTimeout(()=>{Y()},300)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"취소"}),"url"===R&&(0,l.jsx)("button",{onClick:()=>Q(),disabled:!T.trim(),className:"flex-1 px-4 py-2 bg-[#66ae7d] text-white rounded-lg hover:bg-[#497e56] disabled:opacity-50 disabled:cursor-not-allowed",children:"삽입"})]})]})})]})}var y=s(4717);let v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium",s=e,r=[],a=[];[{regex:/!\[([^\]]*)\]\(([^)]+)\)/g,type:"markdown"},{regex:/<img[^>]+src=["']([^"']+)["'][^>]*(?:alt=["']([^"']*)[\"'])?[^>]*\/?>/gi,type:"html"},{regex:/https?:\/\/search\.pstatic\.net\/[^\s\n\r]*(?:\?[^\s\n\r]*)?(?:&[^\s\n\r]*)*/gi,type:"naver"},{regex:/https?:\/\/[^\s\n\r]+\.(?:jpg|jpeg|png|gif|webp|svg)(?:\?[^\s\n\r]*)*/gi,type:"direct"},{regex:/https?:\/\/[^\s\n\r]*[?&]type=[^\s\n\r]*/gi,type:"query"}].forEach(t=>{let s;for(t.regex.lastIndex=0;null!==(s=t.regex.exec(e));){let e=s.index,l=s.index+s[0].length;if(a.some(t=>e>=t.start&&e<t.end||l>t.start&&l<=t.end||e<=t.start&&l>=t.end))continue;let n="",o="이미지",i=s[0];switch(t.type){case"markdown":n=s[2],o=s[1]||"이미지";break;case"html":n=s[1],o=s[2]||"이미지";break;case"naver":case"direct":case"query":n=s[0],o="이미지"}n&&(n.startsWith("http")||n.startsWith("data:"))&&(r.push({url:n,alt:o,index:s.index,originalMatch:i}),a.push({start:e,end:l}))}}),r.sort((e,t)=>t.index-e.index),r.forEach(e=>{let t="__IMAGE_PLACEHOLDER_".concat(e.index,"__");s=s.substring(0,e.index)+t+s.substring(e.index+e.originalMatch.length)});let n=[],i=s.split(/(__IMAGE_PLACEHOLDER_\d+__)/g);console.log("=== 이미지 렌더링 디버그 ==="),console.log("원본 텍스트:",e),console.log("처리된 텍스트:",s),console.log("분할된 텍스트 부분들:",i),console.log("이미지 데이터:",r),i.forEach((e,t)=>{console.log("텍스트 부분 ".concat(t,":"),{content:e,isPlaceholder:e.match(/^__IMAGE_PLACEHOLDER_(\d+)__$/),hasNewlines:e.includes("\n"),startsWithNewlines:/^\n+/.test(e),endsWithNewlines:/\n+$/.test(e),length:e.length})});let c={small:{width:200,height:150,className:"max-w-full h-auto rounded shadow-sm mx-auto"},medium:{width:400,height:300,className:"max-w-full h-auto rounded-lg shadow-sm mx-auto"},large:{width:500,height:400,className:"max-w-full h-auto rounded-lg shadow-md mx-auto"}}[t];return i.forEach((e,s)=>{if(e.match(/^__IMAGE_PLACEHOLDER_(\d+)__$/)){var a;let i=parseInt((null==(a=e.match(/\d+/))?void 0:a[0])||"0"),d=r.find(e=>e.index===i);d&&n.push((0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(o.default,{src:d.url,alt:d.alt,width:c.width,height:c.height,className:c.className,unoptimized:!0,onError:e=>{console.error("이미지 로드 실패: ".concat(d.url)),e.currentTarget.style.display="none"}}),d.alt&&"이미지"!==d.alt&&!d.alt.includes("&")&&(0,l.jsx)("div",{className:"mt-2 text-".concat("small"===t?"xs":"sm"," text-gray-500 italic"),children:d.alt})]},"image-".concat(s)))}else{let r=e,a=s<i.length-1&&i[s+1].match(/^__IMAGE_PLACEHOLDER_(\d+)__$/),o=s>0&&i[s-1].match(/^__IMAGE_PLACEHOLDER_(\d+)__$/);a||o||(r=r.replace(/\n{20,}/g,"\n\n\n\n\n")),a&&(r=r.replace(/\n{20,}$/,"\n\n\n\n\n\n\n\n\n\n")),o&&(r=r.replace(/\n{20,}/,"\n\n\n\n\n")),r.trim()&&("small"===t?n.push(r):n.push((0,l.jsx)("div",{className:"whitespace-pre-wrap",children:r},"text-".concat(s))))}}),n.length>0?n:[(0,l.jsx)("div",{className:"whitespace-pre-wrap",children:j(e)},"fallback")]},j=e=>{console.log("removeAllImageUrls 함수 호출됨"),(e=>{console.log("=== 이미지 URL 디버깅 ==="),console.log("원본 텍스트:",e),[{name:"일반 이미지 URL",regex:/https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|webp|svg)(?:\?[^\s]*)?/gi},{name:"쿼리 파라미터 포함 URL",regex:/https?:\/\/[^\s]+(?:\?[^\s]*type[^\s]*)/gi},{name:"모든 URL",regex:/https?:\/\/[^\s]+/gi},{name:"마크다운 이미지",regex:/!\[[^\]]*\]\([^)]+\)/g},{name:"HTML img",regex:/<img[^>]*>/gi}].forEach(t=>{let{name:s,regex:l}=t,r=Array.from(e.matchAll(l));r.length>0&&console.log("".concat(s," 매치:"),r.map(e=>e[0]))}),console.log("=== 디버깅 완료 ===")})(e);let t=e;[/!\[[^\]]*\]\([^)]+\)/g,/<img[^>]*>/gi,/https?:\/\/search\.pstatic\.net\/[^\s\n\r]*(?:\?[^\s\n\r]*)?(?:&[^\s\n\r]*)*/gi,/https?:\/\/[^\s\n\r]+\.(?:jpg|jpeg|png|gif|webp|svg)(?:\?[^\s\n\r]*)*/gi,/https?:\/\/[^\s\n\r]*[?&]type=[^\s\n\r]*/gi,/https?:\/\/[^\s\n\r]*(?:image|img|photo|pic)[^\s\n\r]*/gi].forEach((e,s)=>{t!==(t=t.replace(e,""))&&console.log("패턴 ".concat(s+1," 적용 후:"),t)});let s=t.replace(/[ \t]+/g," ");return console.log("최종 결과:",s),s},N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=j(e);return s.length>t?s.substring(0,t)+"...":s};function w(e){let{isOpen:t,onClose:s,onEdit:r,onDelete:a,diary:n,canEdit:o=!1,canDelete:i=!1,canLike:c=!1,onToggleLike:x,currentUserId:u}=e;if(!t||!n)return null;let g=(e=>{let t=new Date(e);return{month:["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"][t.getMonth()],year:t.getFullYear(),day:t.getDate(),dayOfWeek:["SUN","MON","TUE","WED","THU","FRI","SAT"][t.getDay()]}})(n.date),h="string"==typeof n.mood?{iconId:"6",text:n.mood,color:"#20B2AA"}:n.mood;return(0,l.jsxs)("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,l.jsx)("button",{onClick:s,className:"p-2 rounded-full text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-all duration-200","aria-label":"닫기",children:(0,l.jsx)(y.Mz4,{className:"w-6 h-6"})}),(0,l.jsx)("div",{className:"text-center",children:(0,l.jsxs)("div",{className:"text-lg font-medium text-gray-800",children:[g.month," ",g.year]})}),(0,l.jsxs)("div",{className:"flex space-x-1",children:[o&&(0,l.jsx)("button",{onClick:r,className:"p-2 rounded-full text-blue-500 hover:text-blue-700 hover:bg-blue-50 transition-all duration-200","aria-label":"수정",children:(0,l.jsx)(y.VUG,{className:"w-5 h-5"})}),i&&(0,l.jsx)("button",{onClick:()=>{confirm("정말 삭제하시겠습니까?")&&a()},className:"p-2 rounded-full text-red-500 hover:text-red-700 hover:bg-red-50 transition-all duration-200","aria-label":"삭제",children:(0,l.jsx)(y.yRo,{className:"w-5 h-5"})})]})]}),(0,l.jsxs)("div",{className:"text-center py-4",children:[(0,l.jsx)("div",{className:"text-2xl font-light text-gray-800",children:g.day}),(0,l.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:g.dayOfWeek})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center p-8 space-y-8 overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,l.jsx)(d,{iconId:h.iconId,size:120}),(0,l.jsx)(m,{emotion:h,size:"md"})]}),n.title&&(0,l.jsx)("h2",{className:"text-xl font-medium text-gray-800 text-center max-w-2xl",children:n.title}),(0,l.jsx)("div",{className:"w-full max-w-2xl flex-1",children:(0,l.jsx)("div",{className:"text-center text-gray-700 text-lg leading-relaxed",style:{fontFamily:"'Noto Sans KR', sans-serif",lineHeight:"2",fontSize:"16px"},children:v(n.content,"large")})}),n.tags&&n.tags.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:n.tags.map((e,t)=>(0,l.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-full",children:["#",e]},t))}),(0,l.jsxs)("div",{className:"text-xs text-gray-400 text-center",children:[n.createdAt&&new Date(n.createdAt).toLocaleString("ko-KR")," 작성",n.updatedAt&&n.updatedAt!==n.createdAt&&(0,l.jsxs)("div",{className:"mt-1",children:[new Date(n.updatedAt).toLocaleString("ko-KR")," 수정"]})]}),(0,l.jsx)("div",{className:"flex items-center justify-center space-x-4 pt-4 border-t border-gray-100",children:c&&x?(0,l.jsxs)("button",{onClick:x,className:"flex items-center space-x-2 px-4 py-2 rounded-full transition-colors ".concat((n.likes||[]).includes(u||"")?"text-red-500 bg-red-50 hover:bg-red-100":"text-gray-400 hover:text-red-500 hover:bg-red-50"),children:[(0,l.jsx)("span",{className:"text-xl",children:(n.likes||[]).includes(u||"")?"❤️":"\uD83E\uDD0D"}),(0,l.jsxs)("span",{className:"text-sm font-medium",children:["좋아요 ",(n.likes||[]).length||0,"개"]})]}):(0,l.jsxs)("div",{className:"flex items-center space-x-2 px-4 py-2 text-gray-400",children:[(0,l.jsx)("span",{className:"text-xl",children:"❤️"}),(0,l.jsxs)("span",{className:"text-sm font-medium",children:["좋아요 ",(n.likes||[]).length||0,"개"]})]})})]}),(0,l.jsx)("div",{className:"h-16"})]})}var E=s(5305);function k(){let{user:e,userProfile:t,loading:s}=(0,a.A)(),[o,i]=(0,r.useState)([]),[c,x]=(0,r.useState)([]),[g,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null),[S,D]=(0,r.useState)(null),[A,I]=(0,r.useState)(""),[T,P]=(0,r.useState)(""),[R,_]=(0,r.useState)(!1),L=e&&t&&"approved"===t.status&&("superAdmin"===t.role||("user"===t.role||"admin"===t.role)&&("sharing-member"===t.memberTier||"operations-office"===t.memberTier));t&&(console.error("\uD83D\uDEA8 USERPROFILE DEBUG:",JSON.stringify(t,null,2)),console.error("\uD83D\uDEA8 PERMISSION CHECK:",{hasUser:!!e,hasUserProfile:!!t,status:t.status,role:t.role,memberTier:t.memberTier,statusApproved:"approved"===t.status,isSuperAdmin:"superAdmin"===t.role,isUser:"user"===t.role,isSharingMember:"sharing-member"===t.memberTier,isOperationsOffice:"operations-office"===t.memberTier,finalResult:L})),console.log("\uD83D\uDD0D Diary 권한 체크:",{user:null==e?void 0:e.uid,userProfile:t?"Object":null,hasWriteAccess:L}),t&&(console.log("\uD83D\uDCCB userProfile 상세 정보:",{role:t.role,memberTier:t.memberTier,status:t.status,uid:t.uid}),console.log("\uD83D\uDD0D 권한 계산 과정:",{isApproved:"approved"===t.status,isSuperAdmin:"superAdmin"===t.role,isUser:"user"===t.role,isAdmin:"admin"===t.role,isSharingMember:"sharing-member"===t.memberTier,isOperationsOffice:"operations-office"===t.memberTier,finalCheck:"approved"===t.status&&("superAdmin"===t.role||("user"===t.role||"admin"===t.role)&&("sharing-member"===t.memberTier||"operations-office"===t.memberTier))})),(0,r.useEffect)(()=>{console.log("=== useEffect 실행 - 의존성 변경 감지 ==="),console.log("현재 user:",null==e?void 0:e.uid),console.log("현재 authLoading:",s),console.log("현재 userProfile:",null==t?void 0:t.role),(async()=>{try{console.log("✅ 일기 로드 시작 (읽기 전용 모드, 인증 무관)"),h(!0),console.log("\uD83D\uDCD6 모든 일기 조회 시도...");let e=await (0,n.kO)();console.log("\uD83D\uDCCA 조회 완료 - 전체 일기 개수:",e.length),i(e),x(e),console.log("✅ 일기 로드 완료")}catch(e){console.error("\uD83D\uDCA5 일기 로드 실패:",e),console.log("에러 상세:",e instanceof Error?e.message:String(e)),i([]),x([]),console.log("⚠️ 에러로 인해 빈 배열 설정")}finally{console.log("\uD83D\uDD04 로딩 상태 해제"),h(!1)}})()},[]);let U=async s=>{if(!e||!L)return void console.log("일기 저장: 권한 없음");try{console.log("일기 저장 시작 - 사용자 UID:",e.uid),console.log("일기 저장 시작 - 사용자 프로필:",t),console.log("일기 저장 데이터:",s);let l={title:s.title,content:s.content,date:s.date,mood:s.mood,tags:s.tags.split(",").map(e=>e.trim()).filter(e=>e),authorId:e.uid,authorName:(null==t?void 0:t.displayName)||e.displayName||e.email||"익명",likes:[]};if(console.log("Firestore에 저장할 일기 데이터:",l),k){console.log("일기 수정 모드 - 기존 일기 ID:",k.id),await (0,n.$D)(k.id,l),console.log("수정 후 전체 일기 데이터 재로드 시작...");let e=await (0,n.kO)();console.log("재로드 완료 - 총 개수:",e.length),i(e),x(e),C(null),console.log("일기 수정 및 재로드 완료")}else{console.log("새 일기 작성 모드");let e=await (0,n.qm)(l);console.log("새 일기 저장 완료 - ID:",e),console.log("저장 후 전체 일기 데이터 재로드 시작...");let t=await (0,n.kO)();console.log("재로드 완료 - 총 개수:",t.length),i(t),x(t),console.log("전체 데이터 재로드 완료")}f(!1)}catch(e){console.error("일기 저장 실패:",e),alert("일기 저장에 실패했습니다.")}},O=()=>{if(!L)return void alert("일기 작성 권한이 없습니다. 로그인 후 이용해주세요.");C(null),f(!0)},F=async s=>{if(!e||s.authorId!==e.uid&&(null==t?void 0:t.role)!=="superAdmin")return void alert("본인이 작성한 일기만 삭제할 수 있습니다.");try{await (0,n.nQ)(s.id),i(e=>e.filter(e=>e.id!==s.id)),x(e=>e.filter(e=>e.id!==s.id)),j(!1)}catch(e){console.error("일기 삭제 실패:",e),alert("일기 삭제에 실패했습니다.")}};(0,r.useEffect)(()=>{let e=[...o];T&&(e=e.filter(e=>{let t=new Date(e.date);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"))===T})),A&&(e=e.filter(e=>e.authorName.toLowerCase().includes(A.toLowerCase()))),x(e)},[o,A,T]);let M=[...new Set(o.map(e=>e.authorName))].sort(),z=[...new Set(o.map(e=>{let t=new Date(e.date);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"))}))].sort().reverse(),B=()=>{I(""),P("")},H=A||T,G=s=>e&&t&&s.authorId!==e.uid,q=async t=>{if(!e)return void alert("좋아요를 하려면 로그인이 필요합니다.");if(G(t))try{let s=await (0,n.ZV)(t.id,e.uid);i(l=>l.map(l=>l.id===t.id?{...l,likes:s.liked?[...l.likes||[],e.uid]:(l.likes||[]).filter(t=>t!==e.uid),likesCount:s.likesCount}:l))}catch(e){console.error("좋아요 토글 실패:",e),alert("좋아요 처리에 실패했습니다.")}};return s?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#66ae7d] mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"로딩 중..."})]})}):t&&"rejected"===t.status?(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("div",{className:"bg-gradient-to-r from-[#66ae7d] to-[#497e56] text-white py-16",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"교단일기"}),(0,l.jsx)("p",{className:"text-xl opacity-90",children:"교육 현장의 성찰과 경험을 기록하는 공간"})]})}),(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"❌"}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"접근 거부"}),(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:"회원가입이 승인되지 않았습니다. 관리자에게 문의해주세요."}),(0,l.jsx)("button",{onClick:()=>window.location.href="/",className:"bg-[#66ae7d] hover:bg-[#497e56] text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"홈으로 돌아가기"})]})})]}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("div",{className:"bg-gradient-to-r from-[#66ae7d] to-[#497e56] text-white py-16",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl md:text-4xl font-bold mb-4",children:"교단일기"}),(0,l.jsx)("p",{className:"text-lg md:text-xl opacity-90 mb-4",children:"교육 현장의 성찰과 경험을 기록하는 공간"}),(0,l.jsx)("p",{className:"opacity-80",children:e?"안녕하세요, ".concat((null==t?void 0:t.displayName)||(null==e?void 0:e.displayName)||"","선생님! 오늘의 교육 경험을 나눠주세요."):"교육 현장의 다양한 경험과 성찰을 함께 나누는 공간입니다."})]})})})}),(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:g?(0,l.jsxs)("div",{className:"flex justify-center items-center py-12",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#66ae7d]"}),(0,l.jsx)("span",{className:"ml-3 text-gray-600",children:"일기를 불러오는 중..."})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-8 flex items-start space-x-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[L?(0,l.jsxs)("button",{onClick:O,className:"bg-[#66ae7d] hover:bg-[#497e56] text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"✏️"}),(0,l.jsx)("span",{children:"새 일기 작성"})]}):(0,l.jsxs)("div",{className:"bg-gray-100 text-gray-500 px-6 py-3 rounded-lg font-medium flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"✏️"}),(0,l.jsx)("span",{children:e&&t?"learning-member"===t.memberTier?"일기 작성은 나눔회원 이상만 이용 가능":"approved"!==t.status?"일기 작성은 승인된 사용자만 이용 가능":"일기 작성 권한이 없습니다":"일기 작성은 로그인 후 이용 가능"})]}),(0,l.jsxs)("button",{onClick:()=>{_(e=>!e)},className:"relative px-4 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2 ".concat(R||H?"bg-blue-100 text-blue-700 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200"),children:[(0,l.jsx)("span",{children:"\uD83D\uDD0D"}),(0,l.jsx)("span",{children:"검색"}),H&&(0,l.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:[A,T].filter(Boolean).length})]})]}),!R&&(0,l.jsxs)("div",{className:"text-sm text-gray-600 ml-auto",children:["총 ",c.length,"개의 일기"]})]}),R&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 animate-in slide-in-from-top-2 duration-300 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"\uD83D\uDD0D"}),(0,l.jsx)("span",{children:"일기 검색"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,l.jsxs)("span",{children:["총 ",c.length,"개의 일기"]}),H&&(0,l.jsx)("button",{onClick:B,className:"text-[#66ae7d] hover:text-[#497e56] font-medium",children:"필터 초기화"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 flex items-center space-x-2",children:[(0,l.jsx)(E.xS0,{className:"text-[#66ae7d]",size:16}),(0,l.jsx)("span",{children:"연/월"})]}),(0,l.jsxs)("select",{value:T,onChange:e=>P(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#66ae7d] focus:border-[#66ae7d] text-sm text-gray-900",children:[(0,l.jsx)("option",{value:"",className:"text-gray-900",children:"모든 시기"}),z.map(e=>{let[t,s]=e.split("-"),r=new Date(parseInt(t),parseInt(s)-1).toLocaleDateString("ko-KR",{year:"numeric",month:"long"});return(0,l.jsx)("option",{value:e,className:"text-gray-900",children:r},e)})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 flex items-center space-x-2",children:[(0,l.jsx)(E.fWL,{className:"text-[#66ae7d]",size:16}),(0,l.jsx)("span",{children:"작성자"})]}),(0,l.jsx)("input",{type:"text",placeholder:"작성자 이름 검색...",value:A,onChange:e=>I(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#66ae7d] focus:border-[#66ae7d] text-sm text-gray-900 placeholder-gray-500",list:"author-suggestions"}),(0,l.jsx)("datalist",{id:"author-suggestions",children:M.map(e=>(0,l.jsx)("option",{value:e},e))})]})]}),H&&(0,l.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"활성 필터:"}),T&&(0,l.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(()=>{let[e,t]=T.split("-");return new Date(parseInt(e),parseInt(t)-1).toLocaleDateString("ko-KR",{year:"numeric",month:"long"})})(),(0,l.jsx)("button",{onClick:()=>P(""),className:"ml-2 text-blue-600 hover:text-blue-800",children:"\xd7"})]}),A&&(0,l.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:["작성자: ",A,(0,l.jsx)("button",{onClick:()=>I(""),className:"ml-2 text-green-600 hover:text-green-800",children:"\xd7"})]})]})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:c.map(s=>{let r="string"==typeof s.mood?u.find(e=>e.text===s.mood)||{iconId:"6",text:s.mood,color:"#20B2AA"}:s.mood,a=(e=>{let t=new Date(e);return{month:t.getMonth()+1,day:t.getDate(),dayOfWeek:["일","월","화","수","목","금","토"][t.getDay()]}})(s.date),n=(e=>{let t=e,s=[],l=[];return[{regex:/!\[([^\]]*)\]\(([^)]+)\)/g,type:"markdown"},{regex:/<img[^>]+src=["']([^"']+)["'][^>]*(?:alt=["']([^"']*)[\"'])?[^>]*\/?>/gi,type:"html"},{regex:/https?:\/\/search\.pstatic\.net\/[^\s\n\r]*(?:\?[^\s\n\r]*)?(?:&[^\s\n\r]*)*/gi,type:"naver"},{regex:/https?:\/\/[^\s\n\r]+\.(?:jpg|jpeg|png|gif|webp|svg)(?:\?[^\s\n\r]*)*/gi,type:"direct"},{regex:/https?:\/\/[^\s\n\r]*[?&]type=[^\s\n\r]*/gi,type:"query"}].forEach(t=>{let r;for(t.regex.lastIndex=0;null!==(r=t.regex.exec(e));){let e=r.index,a=r.index+r[0].length;if(l.some(t=>e>=t.start&&e<t.end||a>t.start&&a<=t.end||e<=t.start&&a>=t.end))continue;let n="",o="이미지",i=r[0];switch(t.type){case"markdown":n=r[2],o=r[1]||"이미지";break;case"html":n=r[1],o=r[2]||"이미지";break;case"naver":case"direct":case"query":n=r[0],o="이미지"}n&&(n.startsWith("http")||n.startsWith("data:"))&&(s.push({url:n,alt:o,index:r.index,originalMatch:i}),l.push({start:e,end:a}))}}),s.sort((e,t)=>t.index-e.index),s.forEach(e=>{t=t.substring(0,e.index)+t.substring(e.index+e.originalMatch.length)}),{cleanText:t.replace(/[ \t]+/g," "),hasImages:s.length>0,imageCount:s.length}})(s.content),o=N(s.content,50);return(0,l.jsxs)("div",{onClick:()=>{D(s),j(!0)},className:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow cursor-pointer p-4 md:p-6 flex flex-col items-center space-y-3 md:space-y-4 h-72 md:h-80",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"text-base md:text-lg font-medium text-gray-800",children:[a.month,"월 ",a.day,"일"]}),(0,l.jsxs)("div",{className:"text-xs md:text-sm text-gray-500",children:[a.dayOfWeek,"요일"]})]}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)(d,{iconId:r.iconId,size:60})}),(0,l.jsx)(m,{emotion:r,size:"sm"}),(0,l.jsx)("div",{className:"text-center flex-1 flex items-center px-2",children:n.hasImages?(0,l.jsxs)("div",{className:"w-full space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-1 text-xs text-gray-500",children:[(0,l.jsx)(y.gTg,{className:"w-4 h-4 text-[#66ae7d]"}),(0,l.jsxs)("span",{children:[n.imageCount,"개 이미지"]})]}),o&&(0,l.jsx)("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 whitespace-pre-line",children:o})]}):(0,l.jsx)("p",{className:"text-xs md:text-sm text-gray-600 line-clamp-2 md:line-clamp-3 whitespace-pre-line",children:o})}),(0,l.jsxs)("div",{className:"flex items-center justify-between w-full pt-2 border-t border-gray-100",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:e&&t&&s.authorId!==e.uid?(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),q(s)},className:"flex items-center space-x-1 px-2 py-1 rounded-full transition-colors ".concat((s.likes||[]).includes((null==e?void 0:e.uid)||"")?"text-red-500 bg-red-50 hover:bg-red-100":"text-gray-400 hover:text-red-500 hover:bg-red-50"),children:[(0,l.jsx)("span",{className:"text-sm",children:(s.likes||[]).includes((null==e?void 0:e.uid)||"")?"❤️":"\uD83E\uDD0D"}),(0,l.jsx)("span",{className:"text-xs font-medium",children:(s.likes||[]).length||0})]}):e?(0,l.jsxs)("div",{className:"flex items-center space-x-1 px-2 py-1 text-gray-400",children:[(0,l.jsx)("span",{className:"text-sm",children:"❤️"}),(0,l.jsx)("span",{className:"text-xs font-medium",children:(s.likes||[]).length||0})]}):(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),alert("좋아요를 하려면 로그인이 필요합니다.")},className:"flex items-center space-x-1 px-2 py-1 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-50 transition-colors cursor-pointer",children:[(0,l.jsx)("span",{className:"text-sm",children:"\uD83E\uDD0D"}),(0,l.jsx)("span",{className:"text-xs font-medium",children:(s.likes||[]).length||0})]})}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:s.authorName})]})]},s.id)})}),0===c.length&&o.length>0&&(0,l.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,l.jsx)("div",{className:"text-4xl md:text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,l.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-2",children:"검색 결과가 없습니다"}),(0,l.jsx)("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"다른 조건으로 검색해보세요."}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("button",{onClick:B,className:"bg-[#66ae7d] hover:bg-[#497e56] text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm",children:"필터 초기화"}),(0,l.jsx)("button",{onClick:()=>_(!1),className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors text-sm",children:"검색 접기"})]})]}),0===o.length&&(0,l.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,l.jsx)("div",{className:"text-4xl md:text-6xl mb-4",children:"✍️"}),(0,l.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-gray-900 mb-2",children:"첫 번째 교단일기를 작성해보세요"}),(0,l.jsx)("p",{className:"text-sm md:text-base text-gray-600 mb-6",children:"교육 현장에서의 경험과 성찰을 기록하는 소중한 공간입니다."}),(0,l.jsx)("button",{onClick:O,className:"w-full sm:w-auto bg-[#66ae7d] hover:bg-[#497e56] text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"첫 일기 작성하기"})]})]})}),(0,l.jsx)(b,{isOpen:p,onClose:()=>{f(!1),C(null)},onSave:U,initialData:k?{title:k.title,content:k.content,mood:"string"==typeof k.mood?u.find(e=>e.text===k.mood)||{iconId:"6",text:k.mood,color:"#20B2AA"}:k.mood,tags:k.tags.join(", "),date:k.date}:void 0,isEditing:!!k}),(0,l.jsx)(w,{isOpen:v,onClose:()=>{j(!1),D(null)},onEdit:()=>(t=>{if(!e||t.authorId!==e.uid)return void alert("본인이 작성한 일기만 수정할 수 있습니다.");C(t),f(!0),j(!1)})(S),onDelete:()=>F(S),diary:S,canEdit:S?!!e&&S.authorId===e.uid:void 0,canDelete:S?!!e&&(S.authorId===e.uid||(null==t?void 0:t.role)==="superAdmin"):void 0,canLike:S?!!G(S):void 0,onToggleLike:S?()=>q(S):void 0,currentUserId:null==e?void 0:e.uid})]})}},6681:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var l=s(283);let r=()=>{let e=(0,l.A)();if(!e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[135,965,479,87,777,670,520,86,441,964,358],()=>e(e.s=2154)),_N_E=e.O()}]);