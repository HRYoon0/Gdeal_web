"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[687],{3068:(e,s,l)=>{l.d(s,{A:()=>i});var t=l(5155),r=l(2115);function i(e){let{onImagesSelected:s,maxImages:l=10,folderId:i="1Ddx2IRs4IvTl1GSZxf7kQjEVlKlgkOuz",currentImageUrls:a=[]}=e,[n,c]=(0,r.useState)([]),[d,o]=(0,r.useState)([]),[x,m]=(0,r.useState)(!1),[h,u]=(0,r.useState)(null),[g,p]=(0,r.useState)([]),[b,j]=(0,r.useState)(i),[f,v]=(0,r.useState)([{id:i,name:"G-DEAL"}]),y=a.map(e=>{let s=e.match(/[?&]id=([^&]+)/);return s?s[1]:""}).filter(Boolean),N="AIzaSyASgrkie4njd-Mk0uF1FbPYj0w9UPg0sOE";(0,r.useEffect)(()=>{w(b)},[]);let w=async e=>{if(!N)return void u("Google API 키가 설정되지 않았습니다.");m(!0),u(null);try{var s,l;console.log("폴더 내용 로딩 시작...",e);let[t,r]=await Promise.all([fetch("https://www.googleapis.com/drive/v3/files?"+new URLSearchParams({q:"'".concat(e,"' in parents and mimeType = 'application/vnd.google-apps.folder'"),fields:"files(id,name,mimeType)",key:N})),fetch("https://www.googleapis.com/drive/v3/files?"+new URLSearchParams({q:"'".concat(e,"' in parents and mimeType contains 'image/'"),fields:"files(id,name,mimeType,thumbnailLink,webViewLink)",key:N}))]);if(!t.ok||!r.ok){if(403===t.status||403===r.status)throw Error("폴더에 접근할 수 없습니다. 폴더가 공개로 설정되어 있는지 확인해주세요.");throw Error("API 오류: ".concat(t.status," / ").concat(r.status))}let[i,a]=await Promise.all([t.json(),r.json()]);console.log("폴더 API 응답:",i),console.log("이미지 API 응답:",a),o(i.files||[]),c(a.files||[]),console.log("".concat((null==(s=i.files)?void 0:s.length)||0,"개의 폴더, ").concat((null==(l=a.files)?void 0:l.length)||0,"개의 이미지를 찾았습니다."))}catch(e){console.error("폴더 내용 로딩 오류:",e),u(e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다.")}finally{m(!1)}},D=e=>{p(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},C=async(e,s)=>{j(e),v(l=>[...l,{id:e,name:s}]),await w(e)},k=async(e,s)=>{j(e),v(e=>e.slice(0,s+1)),p([]),await w(e)},P=async()=>{if(f.length<=1)return;let e=f.length-2,s=f[e];j(s.id),v(s=>s.slice(0,e+1)),p([]),await w(s.id)};return N?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"\uD83D\uDCC1 G-DEAL 폴더 이미지 선택"}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{window.open("https://drive.google.com/drive/folders/".concat(b),"_blank")},className:"inline-flex items-center px-3 py-2 bg-[#66ae7d] text-white text-sm font-medium rounded-md hover:bg-[#497e56] transition-colors",title:"구글 드라이브에서 열기",children:[(0,t.jsx)("span",{className:"mr-1",children:"\uD83D\uDD17"}),"드라이브 열기"]})})]}),x&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#66ae7d]"}),(0,t.jsx)("span",{className:"ml-3 text-gray-600",children:"이미지 로딩 중..."})]}),h&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-l-4 border-red-400 text-sm",children:[(0,t.jsxs)("p",{className:"text-red-700",children:["❌ ",h]}),(0,t.jsx)("button",{onClick:()=>w(b),className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded text-xs hover:bg-red-200",children:"다시 시도"})]}),!x&&!h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500 mr-2",children:"\uD83D\uDCCD"}),f.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center",children:[s>0&&(0,t.jsx)("span",{className:"mx-1 text-gray-400",children:"/"}),(0,t.jsx)("button",{onClick:()=>k(e.id,s),className:"text-blue-600 hover:text-blue-800 hover:underline",disabled:s===f.length-1,children:e.name})]},e.id))]}),f.length>1&&(0,t.jsxs)("button",{onClick:P,className:"inline-flex items-center px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded-md hover:bg-gray-300 transition-colors",title:"상위 폴더로 이동",children:[(0,t.jsx)("span",{className:"mr-1",children:"⬆️"}),"상위 폴더"]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg text-sm",children:[(0,t.jsxs)("div",{className:"text-blue-700",children:["\uD83D\uDCC2 ",(0,t.jsxs)("strong",{children:[d.length,"개"]})," 폴더, \uD83D\uDCC1 ",(0,t.jsxs)("strong",{children:[n.length,"개"]})," 이미지"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"text-blue-600",children:[(0,t.jsxs)("strong",{className:"text-green-600",children:[y.length,"개"]})," 추가됨"]}),g.length>0&&(0,t.jsxs)("div",{className:"text-purple-600",children:[(0,t.jsxs)("strong",{children:[g.length,"개"]})," 선택됨"]})]})]}),(0,t.jsx)("div",{className:"h-16 flex items-center",children:g.length>0?(0,t.jsxs)("div",{className:"w-full flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"text-sm text-purple-700",children:[g.length,"개 이미지 선택됨"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>p([]),className:"px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded-md hover:bg-gray-300",children:"선택 해제"}),(0,t.jsx)("button",{onClick:()=>{if(0===g.length)return void alert("추가할 이미지를 선택해주세요.");let e=l-y.length;if(g.length>e)return void alert("최대 ".concat(l,"개의 이미지만 추가할 수 있습니다. (현재 ").concat(y.length,"개, 추가 가능 ").concat(e,"개)"));let t=g.filter(e=>!y.includes(e));if(0===t.length)return void alert("선택된 이미지가 모두 이미 추가되었습니다.");s(t.map(e=>"https://drive.google.com/thumbnail?id=".concat(e,"&sz=w1000"))),p([])},className:"px-3 py-1 bg-[#66ae7d] text-white text-sm rounded-md hover:bg-[#497e56]",children:"선택한 이미지 추가"})]})]}):(0,t.jsx)("div",{className:"w-full text-center text-sm text-gray-500 py-3",children:"이미지를 클릭하여 선택하세요"})})]}),0===d.length&&0===n.length&&(0,t.jsxs)("div",{className:"p-8 text-center bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-gray-400 text-4xl mb-2",children:"\uD83D\uDCC2"}),(0,t.jsx)("p",{className:"text-gray-600",children:"폴더가 비어있습니다."})]}),(d.length>0||n.length>0)&&(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 max-h-[360px] sm:max-h-[480px] overflow-y-auto border rounded-lg p-4 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[d.map(e=>(0,t.jsxs)("div",{className:"relative cursor-pointer rounded-lg overflow-hidden border-2 border-yellow-200 bg-yellow-50 hover:border-yellow-400 hover:shadow-md transition-all",onClick:()=>C(e.id,e.name),title:"클릭하여 폴더 열기",children:[(0,t.jsx)("div",{className:"aspect-square bg-yellow-100 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-4xl",children:"\uD83D\uDCC2"})}),(0,t.jsx)("div",{className:"p-2 bg-white",children:(0,t.jsxs)("p",{className:"text-xs text-gray-700 truncate font-medium",title:e.name,children:["\uD83D\uDCC1 ",e.name]})})]},e.id)),n.map(e=>(0,t.jsxs)("div",{className:"\n                    relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all\n                    ".concat(y.includes(e.id)?"border-green-500 bg-green-50 opacity-75":g.includes(e.id)?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-[#66ae7d] hover:shadow-md","\n                  "),onClick:()=>D(e.id),onDoubleClick:t=>{var r;t.stopPropagation(),r=e.id,e.name,y.length>=l?alert("최대 ".concat(l,"개의 이미지만 추가할 수 있습니다.")):y.includes(r)?alert("이미 추가된 이미지입니다."):s(["https://drive.google.com/thumbnail?id=".concat(r,"&sz=w1000")])},title:y.includes(e.id)?"이미 추가됨":"클릭으로 선택, 더블클릭으로 즉시 추가",children:[(0,t.jsxs)("div",{className:"aspect-square bg-gray-100",children:[(0,t.jsx)("img",{src:"https://lh3.googleusercontent.com/d/"+e.id+"=w200-h200",alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}),!y.includes(e.id)&&(0,t.jsx)("div",{className:"absolute top-2 left-2",children:(0,t.jsx)("div",{className:"\n                          w-5 h-5 rounded border-2 flex items-center justify-center transition-all\n                          ".concat(g.includes(e.id)?"bg-purple-500 border-purple-500":"bg-white border-gray-300 hover:border-gray-400","\n                        "),children:g.includes(e.id)&&(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 8 8",children:(0,t.jsx)("path",{d:"M6.564.75l-3.59 3.612-1.538-1.55L0 4.26 2.974 7.25 8 2.193z"})})})}),y.includes(e.id)&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-green-500 text-white px-2 py-1 rounded text-xs font-bold",children:"✓ 추가됨"})}),!y.includes(e.id)&&(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-200 flex items-end justify-center pb-2",children:(0,t.jsx)("div",{className:"bg-[#66ae7d] text-white px-2 py-1 rounded text-xs font-bold text-center",children:g.includes(e.id)?"선택됨":"클릭하여 선택"})})]}),(0,t.jsx)("div",{className:"p-2 bg-white",children:(0,t.jsx)("p",{className:"text-xs text-gray-600 truncate",title:e.name,children:e.name})})]},e.id))]})]}),g.length>0&&(0,t.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,t.jsxs)("h4",{className:"font-medium text-purple-800 mb-3",children:["\uD83D\uDCCB 선택된 이미지 (",g.length,"개)"]}),(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 max-h-32 overflow-y-auto",children:g.map(e=>{let s=n.find(s=>s.id===e);return s?(0,t.jsx)("div",{className:"relative group cursor-pointer",onClick:()=>D(e),title:"".concat(s.name," - 클릭하여 선택 해제"),children:(0,t.jsxs)("div",{className:"aspect-square bg-gray-100 rounded overflow-hidden border-2 border-purple-300",children:[(0,t.jsx)("img",{src:"https://lh3.googleusercontent.com/d/"+s.id+"=w200-h200",alt:s.name,className:"w-full h-full object-cover",loading:"lazy"}),(0,t.jsx)("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)("div",{className:"w-4 h-4 bg-red-500 text-white rounded-full flex items-center justify-center text-xs",children:"\xd7"})})]})},e):null})})]}),(0,t.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 text-xs",children:[(0,t.jsx)("p",{className:"font-medium text-blue-800 mb-1",children:"\uD83D\uDCA1 사용법"}),(0,t.jsxs)("div",{className:"text-blue-700 space-y-1",children:[(0,t.jsxs)("p",{children:["• ",(0,t.jsx)("strong",{children:"사진 업로드"}),': "\uD83D\uDD17 드라이브 열기" 버튼을 사용하여 구글 드라이브에 사진을 업로드한 후, 여기서 선택하세요']}),(0,t.jsxs)("p",{children:["• ",(0,t.jsx)("strong",{children:"이미지 선택"}),": 클릭으로 다중 선택, 더블클릭으로 즉시 추가"]}),(0,t.jsxs)("p",{children:["• ",(0,t.jsx)("strong",{children:"일괄 추가"}),': 여러 이미지 선택 후 "선택한 이미지 추가" 버튼 클릭']}),(0,t.jsxs)("p",{children:["• ",(0,t.jsx)("strong",{children:"폴더 탐색"}),": \uD83D\uDCC2 폴더 아이콘을 클릭해서 하위 폴더로 이동"]}),(0,t.jsxs)("p",{children:["• ",(0,t.jsx)("strong",{children:"상위 폴더"}),': "⬆️ 상위 폴더" 버튼으로 이전 폴더로 이동']})]})]})]}):(0,t.jsx)("div",{className:"p-4 bg-yellow-50 border-l-4 border-yellow-400 text-sm",children:(0,t.jsx)("p",{className:"text-yellow-700",children:"⚠️ Google API 키가 설정되지 않았습니다."})})}}}]);