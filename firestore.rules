rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FCM 토큰 컬렉션 - 클라이언트에서 토큰 저장 허용
    match /fcm_tokens/{tokenId} {
      // 누구나 자신의 토큰 문서 생성/수정 가능
      allow create, update: if true;
      // 읽기와 삭제는 인증된 사용자나 Cloud Functions만 가능
      allow read, delete: if request.auth != null;
    }

    // 기존 컬렉션들 (events, trainings, resources, diary)
    // Cloud Functions에서 알림을 발송하기 위해 읽기 허용
    match /events/{eventId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /trainings/{trainingId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /resources/{resourceId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /diary/{diaryId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // 사용자 컬렉션 - 인증된 사용자만 읽기/쓰기 가능
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // 가입 대기 사용자 컬렉션
    match /pendingUsers/{odcId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
